(function($){samo.services=function(){var _ROOT_URL=samo.ROOT_URL;var $module_container=samo.initModuleContainer('services');var _controls=samo.cache_controls($module_container,'input,select,.ATTRIBUTES');let STATEFROM=$module_container.find('.STATEFROM');let CURRENCY=$module_container.find('.CURRENCY');let STATEINC=$module_container.find('.STATEINC');let ADULT=$module_container.find('.ADULT');let CHILDS=$module_container.find('.CHILDS');let CHILD_AGES=$module_container.find('.child_ages');let TYPE=$module_container.find('.TYPE');let TOWN=$module_container.find('.TOWN');let INDIVIDUAL=$module_container.find('.INDIVIDUAL');let ATTRIBUTES=$module_container.find('.ATTRIBUTES');let chosenControls='.STATEFROM, .STATETO, .CURRENCY, .TYPE, .TOWN, .STATEINC, .CHILDS, .ADULT';$(this).find('option').each(function(){if($(this).attr('data-search-string')){$(this).attr('data-search-string',$(this).attr('data-search-string')+' '+$(this).attr('data-search-string').fixKeyboardLayout());}});$(chosenControls).each(function(){var disable_search=true;if($(this).hasClass('STATEFROM')||$(this).hasClass('STATEINC')||$(this).hasClass('TOWN')){disable_search=false;}
$(this).chosen({enable_split_word_search:false,search_contains:true,disable_search:disable_search});});$module_container.find('input.date').datePicker();$module_container.find('.CHILDS').on('change',function(){let name=this.name||$(this).attr('name');$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);let $childAges=$module_container.find('.child_ages');if(this.value>0&&this.value<=3){$childAges.css('visibility','visible');let chDestroy=[];for(let $i=1;$i<=3;$i++){if($i<=this.value){$module_container.find('.age_'+$i).css('visibility','visible').chosen({enable_split_word_search:false,search_contains:true,disable_search:true}).parent().find('.chosen-container:eq('+($i-1)+')').css('width','53px');}else{$module_container.find('.age_'+$i).css('visibility','hidden');if($module_container.find('.age_'+$i).parent().find('.chosen-container:eq('+($i-1)+')').length){chDestroy.push($i);}}}
for(let i=0;i<chDestroy.length;i++){$module_container.find('.age_'+chDestroy[i]).chosen('destroy');}}else{$childAges.css('visibility','hidden').find('.age').css('visibility','hidden');}})
$module_container.find('.search.button').on('click',function(){let DATEBEG=$.controlValue($('.DATEBEG',$module_container).get(0));let DATEEND=$.controlValue($('.DATEEND',$module_container).get(0));if(checkFields(DATEBEG,DATEEND)){let result={};let attr=[];let chi_ag=[];result.STATEFROM=STATEFROM.val();result.STATEINC=STATEINC.val();result.CURRENCY=CURRENCY.val();result.TYPE=TYPE.val();result.TOWN=TOWN.val();result.DATEBEG=DATEBEG;result.DATEEND=DATEEND;result.ADULT=ADULT.val();result.CHILDS=CHILDS.val();CHILD_AGES.find('select').each(function(){if($(this).css('visibility')=='visible'){chi_ag.push(parseInt($(this).val()));}});result.CHILD_AGES=chi_ag.join(',');result.INDIVIDUAL=INDIVIDUAL.is(':checked')?1:0;ATTRIBUTES.find('input:checked').each(function(){attr.push(parseInt($(this).val()));});result.ATTRIBUTES=attr;result.samo_action='RESULT';$.getScript(_ROOT_URL+$.param(result),function(){samo.helpalt_field($module_container,'hover');});}});$module_container.find('.STATEFROM').on('change',function(){let name=this.name||$(this).attr('name');if(name!='STATEFROM'||$.controlValue(name,false,$module_container)){$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);}});$module_container.find('.STATEINC').on('change',function(){let name=this.name||$(this).attr('name');if(name!='STATEINC'||$.controlValue(name,false,$module_container)){$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);}});$module_container.find('.TYPE').on('change',function(){let name=this.name||$(this).attr('name');if(name!='TYPE'||$.controlValue(name,false,$module_container)){$.getScript(getParams(name),function(){$prev_url=getParams('');samo.blink_element();},true);}});$module_container.find('.link.remove').on('click',function(){$(this).parent().hide().remove();});$module_container.find('.DATEBEG').on('change.datepicker',function(){$(_controls.DATEEND).val(this.value);})
function getParams(action){var useGET=arguments[1]||false;let returnObj=arguments[2]||false;var params={};params.samo_action=action;$.each(_controls,function(i,v){let name=v.name||$(v).attr('name');if(!name){return;}
params[name]=$.controlValue(v,useGET);});return returnObj?params:_ROOT_URL+$.param(params);}};function checkFields(datefrom,dateto){let is_ok=true;if(!datefrom){$module_container.find('.DATEBEG').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
if(!dateto){$module_container.find('.DATEEND').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
if(datefrom&&dateto&&datefrom>dateto){$module_container.find('.DATEBEG').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
return is_ok;}
$(samo.services);})(samo.jQuery);