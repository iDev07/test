(function($){samo.partner_guarantee=function(){const _ROOT_URL=samo.ROUTES.partner_guarantee.url,$module_container=$('#partner_guarantee');samo.cache_controls($module_container);$module_container.find('.add_guarantee').on('click',function(){let params={samo_action:'ADD_GUARANTEE'};$.getScript(_ROOT_URL+$.param(params));});samo.guarantee_initform=function(){const $guarantee=$('.new_guarantee');$guarantee.find('input.date').datePicker();$guarantee.find('select.GUARANTEE_BANK').chosen({allow_single_deselect:true,enable_split_word_search:false,search_contains:true});samo.set_data_mask($guarantee);samo.helpalt_field($guarantee);$('#GUARANTEE_FORM').off('submit');$('#GUARANTEE_FORM').on('submit',function(e){e.stopPropagation();e.preventDefault();if(check_fields()){const $submit=$(this).find('input:submit');$submit.prop('disabled',true);var frm=document.getElementById("GUARANTEE_FORM");var formData=new FormData(frm);$.ajaxSetup({processData:false,contentType:false});$.post(_ROOT_URL+'samo_action=SAVE_GUARANTEE',formData,function(){$submit.prop('disabled',false);},'script');}});};$module_container.find('.resultset').on('change','.upload-attach',function(e){var frm=document.getElementById("SAVE_ATTACHMENT_FORM_"+$(this).data('guarantee-inc'));var formData=new FormData(frm);$.ajaxSetup({processData:false,contentType:false});$.post(_ROOT_URL+'samo_action=SAVE_ATTACHMENT',formData);}).on('click','.download-attach',function(){const fileInc=$(this).data('fileInc');$.getScript(_ROOT_URL+'samo_action=DOWNLOAD&fileInc='+fileInc);return false;});function check_fields(){let is_ok=true;const $form=$('.new_guarantee');samo.field.clear_errors($form);$form.find('.required').not('label').each(function(){if(!$(this).val().length){is_ok=samo.field.error(samo.i18n('REQUIRED_FIELD_EMPTY'),this);return false;}});if(is_ok){$form.find('.date').each(function(){if(this.value.length&&!$.valid_date(this)){is_ok=samo.field.error(samo.i18n('DATE_FORMAT_TITLE'),this);return false;}});}
return is_ok;}};$(samo.partner_guarantee);})(samo.jQuery);