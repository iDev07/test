(function($){var _ROOT_URL=null;var container=samo.initModuleContainer('hotels');samo.hotels=function(){_ROOT_URL=samo.ROUTES.hotels.url;var $module_container=container;samo.searchTimer=null;var controls=samo.cache_controls($module_container,'.STATEINC,.HOTELINC');controls.TOWNS=$module_container.find('.TOWNS');controls.STARS=$module_container.find('.STARS');controls.load=$module_container.find('.load');controls.resultset=$module_container.find('.resultset')[0];controls.PARAMS=$module_container.find('.PARAMS')[0];$module_container.find('.location select option').each(function(){var $option=$(this),searchString=this.text;if(searchString){$option.attr('data-search-string',searchString+' '+searchString.fixKeyboardLayout());}});$(controls.STATEINC).on('change',function(){var params={STATEINC:this.value};window.location.href=_ROOT_URL+$.param(params);}).chosen();$(controls.HOTELINC).on('change',function(){window.location.href=_ROOT_URL+'samo_action=hotel&HOTELINC='+this.value;}).chosen({placeholder_text_single:samo.i18n('NOT_SET_HOTELINC')});$(controls.TOWNS).on('click','input',function(){var $groupbox=$(this).parents('div.groupbox');if($groupbox.length){if($(this).is('.group')){var inputs=$groupbox.find('input').not('.group').not('input.district').prop('checked',this.checked).parents('label');if(this.checked){inputs.removeClass('hidden');inputs.children('div.DISTRICTS').find('label').removeClass('hidden')
if(inputs.length>1){inputs.find('input').not('input.district').addClass('semiselected');}}else{inputs.not('input.district').addClass('hidden');inputs.find('input.district').prop('checked',false);if(inputs.length>1){inputs.find('input').removeClass('semiselected');}}}else{var $all=$groupbox.find('input').not('.group').not('input.district');if($(this).is('.semiselected')){$groupbox.find('.semiselected').removeClass('semiselected').prop('checked',false);$(this).prop('checked',true);}
var checked=$all.filter(':checked').length;if($all.length==checked||checked==0){$groupbox.find('input.group').prop('checked',checked>0);if(0==checked){$groupbox.find('label').not('.groupname').addClass('hidden');$groupbox.find('label').not('.groupname').children('input.district').prop('checked',false);}}}}
samo.delaySearch();});$(controls.resultset).on('click','.show-detail',function(){var $this=$(this),$parent=$this.parent();$this.toggleClass('ui-icon-triangle-1-s','ui-icon-triangle-1-n');$parent.toggleClass('all','attributes');return false;}).on('change','input.tour',function(){$(controls.resultset).find('.search.unchecked').removeClass('unchecked');if($(controls.resultset).find('input[type=checkbox].tour:checked').length){$(controls.resultset).find('input[type=checkbox].tour:not(:checked)').parent().addClass('unchecked');}}).on('click','.link.tour',function(){var params={STATEINC:$.controlValue(controls.STATEINC),DOLOAD:1};params.HOTELS=$(controls.resultset).find('[name="HOTELS[]"]:checked').map(function(){return this.value;}).get().join(',');window.location.href=samo.ROUTES[samo.search_page].url+$.param(params);}).on('click','span.page',function(){samo.doSearch($(this).data('page'));});samo.doSearch=function(){var params={samo_action:'SEARCH'};if(arguments.length==1){params.PAGE=parseInt(arguments[0]);}
params.STATEINC=$.controlValue(controls.STATEINC);params.TOWNS=$module_container.find('[name="TOWNS[]"]:checked').map(function(){return this.value;}).get().join(',');params.DISTRICTS=$module_container.find('[name="DISTRICTS[]"]:checked').map(function(){return this.value;}).get().join(',');params.STARS=$module_container.find('[name="STARS[]"]:checked').map(function(){return this.value;}).get().join(',');params.ATTRIBUTES=$module_container.find('[name="ATTRIBUTES[]"]:checked').map(function(){return this.value;}).get().join(',');$.getScript(_ROOT_URL+$.param(params),null,true);};samo.delaySearch=function(){if(samo.searchTimer){clearTimeout(samo.searchTimer);}
samo.searchTimer=setTimeout(samo.doSearch,900);};$(controls.PARAMS).on('click','label',function(){if($(this).is('.any')){$(this).addClass('hide');$(this).parents('.container:first').find('.checklistbox input').prop('checked',false);}else{if($(this).find('input:checked').length){$(this).parents('.container:first').find('.any').removeClass('hide');}else{$(this).parents('.container:first').find('.any').addClass('hide');}}
samo.delaySearch();});$(controls.load).on('click',samo.doSearch);if($module_container.find('.resultset.scrolling').length){var $resultset=$(controls.resultset);var resulset_offset=$resultset.offset();var offsetResultset=resulset_offset.top;samo.scrollTimeout=null;samo.scrollResult=function(){var $window=$(window);var top=$resultset.offset().top;var scrollTop=$(document).scrollTop();var windowHeight=$window.height();var heightResultset=$resultset.parent().height();var resultsetHeight=$resultset.height();if(!(top<scrollTop&&top+resultsetHeight>scrollTop+windowHeight)){var margin=0;if(top+resultsetHeight<scrollTop+windowHeight&&resultsetHeight>windowHeight){margin=scrollTop+windowHeight-resultsetHeight-offsetResultset;}else{margin=scrollTop-offsetResultset;}
var height=$resultset.outerHeight();if(heightResultset<margin+height){margin=heightResultset-height;}
if(margin<0){margin=0;}
$resultset.animate({marginTop:margin},1000);}};$(window).scroll(function(){if(samo.scrollTimeout){clearTimeout(samo.scrollTimeout);}
samo.scrollTimeout=setTimeout(samo.scrollResult,1500);});$(window).scroll();}
var $photos=$module_container.find(".photos");if($photos.length){$photos.find("a.thumbnail").fancybox();}
$module_container.find('.map_container').samoMap();function initPriceResultset(){samo.price_clickable($module_container);$.each($('table.res tr th'),function(i,v){$(v).width($(v).width());});}
if($('#hotels.details .load_price').length){$module_container.find('.controls select').chosen();var priceRefresh=function(){var params={samo_action:'PRICE'};var $townFrom=$module_container.find('.TOWNFROMINC');params.TOWNFROMINC=$.controlValue($townFrom.get(0));if(1==params.TOWNFROMINC){params.STATEFROM=$townFrom.find('option:selected').data('statefrom');}
params.CURRENCY=$.controlValue($('.CURRENCY',$module_container).get(0));params.CHECKIN_BEG=params.CHECKIN_END=$.controlValue($('.CHECKIN',$module_container).get(0));params.NIGHTS_FROM=$.controlValue($('.NIGHTS_FROM',$module_container).get(0));params.NIGHTS_TILL=$.controlValue($('.NIGHTS_TILL',$module_container).get(0));params.HOTELINC=$.getParameter('HOTELINC',true,$module_container);$module_container.find('.hotel_descr .resultset').html('<div style="text-align: center; margin-bottom: 10px;"><img src="'+samo.ROUTES.WWWROOT+'public/pict/preloader.gif" /></div>');$.getScript(_ROOT_URL+$.param(samo.getParams(params,$module_container)),initPriceResultset,true,false);};samo.hotels.reDatePicker=function(control,valids,start,value){$('input.date.'+control,$module_container).data('prev',value).datePicker({start:start,valid:valids.toString(),value:value});};$module_container.find('input.date').each(function(i,v){$(v).data('prev',$(v).val()).datePicker().on('change.datepicker',function(e,d){if(d&&$(this).data('prev')!=$(this).clearVal()){$(this).data('prev',$(this).val());priceRefresh();}});});samo.price_helpers($module_container);$('#hotels.details .load_price').find('select, input').on('change',priceRefresh);priceRefresh();}};$(samo.hotels);})(samo.jQuery);