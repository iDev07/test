"use strict";(function($){samo.invoice_print=function(CLAIM){var $link=$('#invoice_'+CLAIM);var params={CLAIM:CLAIM};params.BANK=samo.bank;params.CURRENCYEX=samo.currencyEx;params.INVOICE_AMOUNT=samo.invoice_amount;$link.attr('href',samo.ROUTES.invoice.url+$.param(params)).data('prefix',$link.html()+' - ').html('');$link.off('click').one('click',samo.delayed_download).click();};samo.invoice_error=function(CLAIM,message){var $link=$('#invoice_'+CLAIM);$link.errorField(message).addClass('error').attr('href','#invoice_'+CLAIM).removeAttr('target');$link.off('click');};samo.invoice=function(){var $module_container=$('#INVOICE_EDIT_SUMM');$module_container.find('#BANK').change(function(){if($('#INVOICE_AMOUNT').length){$('#INVOICE_AMOUNT').val('');$('#INVOICE_AMOUNT').prop('disabled',true);if(!parseInt($(this).val())){return;}
var claim=$module_container.data('claim');var option=$(this).find('option:selected');var params={};params['BANK']=parseInt($(this).val());params['CURRENCYEX']=option.data('currency');$.get(samo.ROUTES.invoice.url+$.param({CLAIM:claim,samo_action:'UPDATE_DEBT'}),params,null,'script');}}).chosen();$module_container.find('.load').click(function(){if(check_fields()){var claim=$module_container.data('claim');if($('#BANK').length){var option=$('#BANK').find('option:selected');samo.bank=parseInt($($('#BANK')).val());samo.currencyEx=option.data('currency');}
if($('#INVOICE_AMOUNT').length){samo.invoice_amount=parseFloat($('#INVOICE_AMOUNT').val());}
$.modal.close();samo.invoice_print(claim);}});function check_fields(){var $fld=$module_container.find('#BANK');if($fld.length&&!parseInt($fld.val())){$fld.errorField(samo.LANG.REQUIRED_FIELD_EMPTY).addClass('error').get(0).focus();return false;}
$fld=$module_container.find('#INVOICE_AMOUNT');if($fld.length){if($fld.prop('disabled')||!$fld.val().length){$fld.errorField(samo.LANG.REQUIRED_FIELD_EMPTY).addClass('error').get(0).focus();return false;}
var tmp=parseFloat($fld.val());if(tmp!=$fld.val()||tmp<0){$fld.errorField(samo.LANG.INVALID_INVOICE_AMOUNT).addClass('error').get(0).focus();return false;}
if(tmp===0){$fld.errorField(samo.LANG.NO_INVOICE_AMOUNT).addClass('error').get(0).focus();return false;}
var tmp2=parseFloat($fld.attr('max'));if(tmp>tmp2){$fld.val(tmp2);$fld.errorField(samo.LANG.INVOICE_AMOUNT_BIG+' '+$fld.attr('max')).addClass('error').get(0).focus();return false;}}
return true;}}})(samo.jQuery);