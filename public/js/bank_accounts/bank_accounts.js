(function($){samo.bank_accounts=function(){const _ROOT_URL=samo.ROUTES.bank_accounts.url,$module_container=$('#bank_accounts');samo.cache_controls($module_container);$module_container.find('.delete_bank_account').on('click',function(){var account_title=$(this).parents('.bank_account').data('bank_account_title');if(confirm(samo.i18n('CONFIRM_DELETE_BANK_ACCOUNT').replace('%s',account_title))){let params={samo_action:'deleteBankAccount',accountId:$(this).parents('.bank_account').data('bank_account_id')};$.getScript(_ROOT_URL+$.param(params));}}).end().find('.edit_bank_account').on('click',function(){let params={samo_action:'showFormBankAccount',accountId:$(this).parents('.bank_account').data('bank_account_id')};$.getScript(_ROOT_URL+$.param(params));}).end();samo.add_bank_binder=function(){let params={samo_action:'showFormBankAccount'};$.getScript(_ROOT_URL+$.param(params));}
samo.bank_account_initform=function(){var $bank_account=$('.new_bank_account');$bank_account.find('input.PARTNERBANK_BANK').on('keyup',function(e){var $bank=$bank_account.find('.bank_name');$bank.text('');if(e.key==="Escape"){this.value='';}
samo.bank_filter();}).on('blur',samo.bank_filter);samo.set_data_mask($bank_account);samo.helpalt_field($bank_account);$('#BANK_ACCOUNT_FORM').off('submit');$('#BANK_ACCOUNT_FORM').on('submit',function(e){e.stopPropagation();e.preventDefault();if(check_fields()){const $submit=$(this).find('input:submit');$submit.prop('disabled',true);var frm=document.getElementById("BANK_ACCOUNT_FORM");var formData=new FormData(frm);$.ajaxSetup({processData:false,contentType:false});$.post(_ROOT_URL+'samo_action=saveBankAccount',formData,function(){$submit.prop('disabled',false);},'script');}});samo.bank_filter();}
function check_fields(){let is_ok=true;const $form=$('.new_bank_account');samo.field.clear_errors($form);$form.find('.required').not('label').each(function(){if(!$(this).val().length){is_ok=samo.field.error(samo.i18n('REQUIRED_FIELD_EMPTY'),this);return false;}}).end().find('input[name*="[PARTNERBANK_BANK]"]').each(function(){if(!$(this).val().length){is_ok=samo.field.error(samo.i18n('BANK_NOT_FOUND'),this);return false;}});return is_ok;}
samo.bank_filter=function(){var $bank_account=$('.new_bank_account');var $bik=$bank_account.find('input.PARTNERBANK_BANK');if($bik.length){var $bank=$bank_account.find('.bank_name');var $hiddenbank=$bank_account.find('input[name*="[PARTNERBANK_BANK]"]');var val=$bik.val().trim(),found=false;if(val.length>0){$bank.removeClass('error');$bank.text('');var bankListFull=$bik.data('variants')||[];$.each(bankListFull,function(key,bank){if(val==bank.bik){$bank.text(bank.Name);$hiddenbank.val(bank.Inc);found=true;$bank_account.find('input[type="submit"]').prop('disabled',false);return true;}});if(!found){$bank.text(samo.i18n('BANK_NOT_FOUND')).addClass('error');$bank_account.find('input[type="submit"]').prop('disabled',true);}else{$bank.removeClass('error');}}else{$hiddenbank.val('');$bank.text('');}}};samo.bank_filter();}
$(samo.bank_accounts);})(samo.jQuery);