(function($){"use strict";const $zoom=15;var workhorse;samo.Map=function($module_container){const mapContainer=$module_container.find('.map_container');let options;let $useMaps;if(mapContainer.length){if(mapContainer.attr('data-map-options').length){options=mapContainer.data('map-options');if(options.key.length){const addressField=$module_container.find("input[name*='[PARTNER_ADDRESS]']");addressField.parent().append('<a href="#" id="showMap">'+samo.i18n('MARK_ON_MAP')+'</a>');$module_container.find("#showMap").click(function(){const modalSettings={width:768,height:580};$('#ya_map').addClass('hidden');$.modal('<div class="googleMap"><div id=\"ya_map_agency\"></div>'+$module_container.find(".googleMapWindow").html()+'</div>'+'<p>'+samo.i18n('MOVE_THE_MARKER_TO_MATCH_YOUR_ADDRESS')+'</p>'+'<div class="closeMapButton"><button class="modalClose">'+samo.i18n('SAVE_AND_CLOSE')+'</button></div>',{width:parseInt(modalSettings.width)+20,height:parseInt(modalSettings.height)+20,title:samo.i18n('ADDRESS_MARKING_ON_THE_MAP')});$useMaps=$module_container.find('input[name*="useMaps"]');if(options.usemaps==mapContainer.data('is-google-map')){samo.GoogleMap($module_container);}else if(options.usemaps==mapContainer.data('is-yandex-map')){samo.YandexMap($module_container);}
return false;});}}}};samo.YandexMap=function($module_container){let latField=$module_container.find('input[name*="[PARTNER_GEOLAT]"]');let lonField=$module_container.find('input[name*="[PARTNER_GEOLON]"]');let addressField=$module_container.find('input[name*="[PARTNER_ADDRESS]"]');let cityField=$module_container.find('select[name*="[PARTNER_TOWN]"] option:selected');if(!cityField.length){cityField=$module_container.find('span[data-frm-name*="[PARTNER_TOWN]"]');}
const searchAddress=cityField.text()+', '+addressField.val();ymaps.ready(function(){var myMap=new ymaps.Map("ya_map_agency",{center:[55.76,37.64],draggable:true,zoom:$zoom,},{searchControlProvider:'yandex#search'});var myGeocoder=ymaps.geocode(searchAddress);myGeocoder.then(function(res){myMap.setCenter(res.geoObjects.get(0).geometry._coordinates,$zoom);var myPlacemark=new ymaps.Placemark(res.geoObjects.get(0).geometry.getCoordinates());if($(location).attr("pathname")=='/edit_agency'||$(location).attr("pathname")=='/register_agency'){myPlacemark.options.set({draggable:true});}
$(".gdocsviewer").addClass('hidden');myPlacemark.events.add('dragend',function(e){var coords=e.get('target').geometry.getCoordinates();latField.val(coords[1].toPrecision(6));lonField.val(coords[0].toPrecision(6));ymaps.geocode(coords).then(function(res1){var firstGeoObject=res1.geoObjects.get(0);addressField.val(firstGeoObject.getAddressLine());myPlacemark.properties.set('balloonContent',firstGeoObject.getAddressLine());});});myMap.geoObjects.add(myPlacemark);},function(err){console.log(err);})});};samo.GoogleMap=function($module_container){const container=$module_container.find('.map_container');let options=container.data('map-options');const googleContainer=$('#basicModalContent').find('.googleMap');let map=null;samo.initMap=function(){let latField=$module_container.find('input[name*="[PARTNER_GEOLAT]"]');let lonField=$module_container.find('input[name*="[PARTNER_GEOLON]"]');let addressField=$module_container.find('input[name*="[PARTNER_ADDRESS]"]');let cityField=$module_container.find('select[name*="[PARTNER_TOWN]"] option:selected');if(!cityField.length){cityField=$module_container.find('span[data-frm-name*="[PARTNER_TOWN]"]');}
let searchAddress=cityField.text()+', '+addressField.val();let geocoder=new google.maps.Geocoder();geocoder.geocode({'address':searchAddress},function(results,status){if(latField.val().length&&lonField.val().length){options.latitude=latField.val();options.longitude=lonField.val();}else if(status==='OK'&&searchAddress.length){options.latitude=results[0].geometry.location.lat();options.longitude=results[0].geometry.location.lng();}
var point=new google.maps.LatLng(options.latitude,options.longitude);const mapOptions={center:point,zoom:$zoom,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(googleContainer[0],mapOptions);var marker=new google.maps.Marker({position:point,map:map,draggable:true});google.maps.event.addListener(marker,'dragend',function(){var pointer=marker.getPosition();latField.val(pointer.lat());lonField.val(pointer.lng());const geocoder=new google.maps.Geocoder();geocoder.geocode({location:pointer}).then((response)=>{addressField.val(response.results[0].formatted_address);});});});workhorse=google.maps;return workhorse;};if(typeof workhorse=='undefined'){$.getScriptReal("//maps.googleapis.com/maps/api/js?key="+options.key+"&sensor=false&&callback=samo.initMap");}else{samo.initMap();}};})(samo.jQuery);