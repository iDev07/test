(function($){var container=samo.initModuleContainer('insures');var price_url=null;var _ROOT_URL=samo.ROOT_URL;var $module_container=container;samo.insures=function(){var DOLOAD=(parseInt($.getParameter('DOLOAD',true,$module_container))==1);var _controls=samo.cache_controls($module_container,'.STATEFROM,.STATETO');let STATEFROM=$module_container.find('.STATEFROM');let STATEINC=$module_container.find('.STATETO');let INSURETYPES=$module_container.find('.INSURETYPE');let CURRENCY=$module_container.find('.CURRENCY');let AGES=$module_container.find('.AGES');var chosenControls='.STATEFROM,.STATETO,.CURRENCY,.INSURETYPE';$(this).find('option').each(function(){if($(this).attr('data-search-string')){$(this).attr('data-search-string',$(this).attr('data-search-string')+' '+$(this).attr('data-search-string').fixKeyboardLayout());}});$(chosenControls).each(function(){var disable_search=true,chosenEl;if($(this).hasClass('STATEFROM')||$(this).hasClass('STATETO')){disable_search=false;}
$(this).chosen({enable_split_word_search:false,search_contains:true,disable_search:disable_search});chosenEl=$(this).parent().find('.chosen-container');chosenEl.addClass($(this).attr('name')+'_chosen');chosenEl.css('text-align','left').css('width','100%');});$module_container.find('input.date').datePicker();$module_container.find('.search.button').on('click',function(){let DATEBEG=$.controlValue($('.DATEBEG',$module_container).get(0));let DATEEND=$.controlValue($('.DATEEND',$module_container).get(0));if(checkFields(DATEBEG,DATEEND)){let result={};result.STATEFROM=STATEFROM.val();result.STATEINC=STATEINC.val();result.INSURETYPES=INSURETYPES.val();result.CURRENCY=CURRENCY.val();let AGES=$module_container.find('.AGES');let ages=[];AGES.each(function(){ages.push($(this).val());});result.AGES=ages.join(',');result.DATEBEG=DATEBEG;result.DATEEND=DATEEND;result.samo_action='RESULT';$.getScript(_ROOT_URL+$.param(result));}});$module_container.find('.link.add').on('click',function(){let new_age=$(this).prev().last('.AGES_CONTAINER').clone();new_age.find('select').val(18);new_age.find('.link.remove').css('visibility','visible');$(this).before(new_age);$module_container.find('.link.remove').on('click',function(){$(this).parent().hide().remove();});});$module_container.find('.link.remove').on('click',function(){$(this).parent().hide().remove();});};samo.addrisks=function(){$module_container.find('.addrisks').on('click',function(){var params={samo_action:'PRICEDETAIL',INSURE:$(this).data('id'),};$.getScript(_ROOT_URL+$.param(params),null,false);});}
samo.additional_risks=function(){$('#basicModalContent').find('.additional_risks input').change(function(){let price=parseFloat($(this).closest('tr').data('price'));let total_price=parseFloat($('#total_cost').html());if(!$(this).is(':checked')){price=-price;}
total_price+=price;total_price=parseInt(100*total_price)/ 100;$('#total_cost').html(total_price);let risks=[];$('#basicModalContent').find('.additional_risks input').each(function(){if($(this).is(':checked')&&!$(this).is(':disabled')){risks.push($(this).data('id'));}});risks=risks.join(',');let href=$('#total_cost').closest('a').attr('href');href=href+'&'+$.param({RISKS:risks});$('#total_cost').closest('a').attr('href',href);});}
samo.note=function(note){var $container=container.find('.note_container');if(note){$container.ehtml(note).removeClass('blank-note');}else{$container.empty().addClass('blank-note');}};function checkFields(datefrom,dateto){let is_ok=true;if(!datefrom){$module_container.find('.DATEBEG').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
if(!dateto){$module_container.find('.DATEEND').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
if(datefrom&&dateto&&datefrom>dateto){$module_container.find('.DATEBEG').errorField(samo.i18n('INCORRECT_DATE'));is_ok=false;}
return is_ok;}
$(samo.insures);})(samo.jQuery);