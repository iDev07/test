(function($){var container=samo.initModuleContainer('cl_refer');var _ROOT_URL=samo.ROUTES.cl_refer.url,$module_container=container;samo.cl_refer=function(){var _controls=$module_container.find('input:text');samo.cache_controls($module_container);$.each(['edit_tourist','agreement_person'],function(){if(typeof samo.ROUTES[this]!='undefined'){$.require(samo.ROUTES.WWWROOT+'public/js/'+this+'/'+this+'.js');}});$module_container.find('.date').datePicker().end().find('.CLAIMBEGIN').numeric().end().find('.resultset').on('click','span.page',function(){getClaims($(this).data('page'));}).on('click','.toggle_orders',function(){var self=$(this),CLAIM=parseInt(self.parents('table.cl_refer_result:first').data('claim'));self.text(samo.i18n('LOADING'));samo.load_orders(CLAIM);}).on('click','span.msg',function(){var claim=parseInt($(this).parents('table:first').data('claim'));samo.claim_messages(claim);}).on('click','span.msg-new',function(){var claim=parseInt($(this).parents('table:first').data('claim'));samo.claim_message_form(claim);}).on('click','.link.cancel_claim',function(){var claim=parseInt($(this).parents('table:first').data('claim'));$.getScript(samo.ROUTES.cancel_claim.url+$.param({CLAIM:claim}));});$module_container.find('.PARTNERCLAIM,.CLAIMTYPE,.PAYTYPE,.STATECLAIM,.MANAGERCLAIM,.TOMANAGERCLAIM').chosen({no_results_text:samo.i18n('NODATA'),enable_split_word_search:false,search_contains:true});$module_container.on('click','span.add_service',function(){var claim=parseInt($(this).parents('table:first').data('claim'));$.getScript(_ROOT_URL+$.param({CLAIM:claim,samo_action:'CLAIM_SERVICE_LIST'}),function(){var $container=$('#ADDITIONAL_SERVICES');$container.find('.date').datePicker();$container.find('.FREIGHTINFO_PORT').chosen();$container.find('.FREIGHTINFO_TIME').mask('99:99');$container.find('.FREIGHTINFO_PORT').on('change',function(e){var mainserviceuid=$(this).parents('tr:first').data('mainserviceuid');var $mainservicetr=$container.find('tr[data-mainserviceuid="'+mainserviceuid+'"]');$mainservicetr.find('.mainservice').prop('checked',$(this).val());});$container.find('.FREIGHTINFO_PORT').trigger('change');$container.find('.servtype-container label').on('click',function(e){var radio=$(this).parent().find(':radio');if(radio.prop('checked')===true){e.preventDefault();radio.prop('checked',false);}});$('.claim_service_list_save').on('click',function(){if($container.find(':checkbox').filter(':checked').length){var params={};var services={};var is_ok=true;$container.find('.mainservice').filter(':checked').each(function(){var $tr=$(this).parents('tr:first');var data=$tr.data();var service_json=data.json;var mainserviceuid=data.mainserviceuid;if($tr.find('.service_dates').length){let $option=$tr.find('.service_dates').find('option:selected');service_json.uid=$option.val();service_json.datebeg=$option.data('datebeg');service_json.dateend=$option.data('dateend');}
if(data.needfreightinfo){const $freightinfotr=$container.find('tr.freightInfo[data-mainserviceuid="'+mainserviceuid+'"]');const $port=$freightinfotr.find('.FREIGHTINFO_PORT'),port=$port.val();if(!port){$port.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
const $freight=$freightinfotr.find('.FREIGHTINFO_FREIGHT'),freight=$freight.val();if(!freight){$freight.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
const $date=$freightinfotr.find('.FREIGHTINFO_DATE'),date=$date.val();if(!date){$date.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
const $time=$freightinfotr.find('.FREIGHTINFO_TIME'),time=$time.val();if(!time){$time.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
service_json.freightinfo_port=port;const portData=$port.find('option:selected').data();service_json.freightinfo_town=portData.town;service_json.freightinfo_terminal=portData.terminal;service_json.freightinfo_freight=freight;service_json.freightinfo_date=date;service_json.freightinfo_time=time;}
services[mainserviceuid]={'service':service_json};});if(!is_ok){return false;}
$container.find('.tourist_service').filter(':checked').each(function(){var mainserviceuid='\''+$(this).data('mainserviceuid')+'\'';var people=$(this).data('people');if(!services[mainserviceuid]){var service=$container.find('tr[data-mainserviceuid='+mainserviceuid+']');var service_json=service.data('json');service_json.count=1;service_json.clients=[{'peopleKey':people,'common':people}];if(service.find('.service_dates').length){var $option=service.find('.service_dates').find('option:selected');service_json.uid=$option.val();service_json.datebeg=$option.data('datebeg');service_json.dateend=$option.data('dateend');}
services[mainserviceuid]={'service':service_json};}else{services[mainserviceuid].service.clients.push({'peopleKey':people,'common':people});services[mainserviceuid].service.count++;}});params.SERVICES=services;this.disabled=true;$.post(_ROOT_URL+$.param({CLAIM:claim,samo_action:'CLAIM_SERVICE_LIST_SAVE'}),params,false);}else{$.modal.close();}});});});$module_container.on('click','span.add_insurance',function(){var claim=parseInt($(this).parents('table:first').data('claim'));$.getScript(_ROOT_URL+$.param({CLAIM:claim,samo_action:'CLAIM_INSURANCE_LIST'}),function(){var $container=$('#additional_insures');$container.on('click','input:checkbox',function(){var $cbx=$(this);var complete=$cbx.data('complete');var $tr=$cbx.parents('tr:first');var insuretype=$tr.data('insuretype');var maininsureuid=$tr.data('maininsureuid');var ttable=$cbx.parents('table:first');var tbody=$cbx.parents('tbody:first');if($cbx.is('.maininsure')&&!$cbx.prop('checked')){if(complete){ttable.find('tr[data-maininsureuid='+maininsureuid+'] input:checkbox[data-complete=1]:not(:disabled)').prop('checked',false);}}else{if($cbx.prop('checked')){if($cbx.is('.maininsure')){if(ttable.find('tr[data-insuretype='+insuretype+'] input.maininsure:checkbox[data-complete=1]:disabled').length||tbody.find('tr[data-insuretype='+insuretype+'] input.maininsure:checkbox:disabled').length){msg(samo.i18n('BRON_CHOOSE_SAME_INSURE')+': '+$cbx.data('insure_type_name'));return false;}
if(complete){ttable.find('tr[data-insuretype='+insuretype+'] input:checkbox:not(:disabled)').prop('checked',false);ttable.find('tr[data-maininsureuid='+maininsureuid+'] input:checkbox[data-complete=1]:not(:disabled)').prop('checked',true);}else{tbody.find('tr[data-insuretype='+insuretype+'] input:checkbox:not(:disabled)').prop('checked',false);$cbx.prop('checked',true);}}else{var $main_cbx=$tr.find('input:first');if(!$main_cbx.prop('checked')){msg(samo.i18n('BRON_CHOOSE_MAIN_INSURE')+': '+$tr.find('label:first').text());return false;}}}}});$('.claim_insurance_list_save').on('click',function(){var changes=false;$container.find(':checkbox').each(function(){if(this.defaultChecked!=this.checked){changes=true;return false;}});if(changes){var insures={};$container.find('.maininsure').filter(':checked').each(function(){var $tr=$(this).parents('tr:first'),data=$tr.data();var insure_json=data.json;var maininsureuid=data.maininsureuid;var people=data.people;insure_json.clients=[{'peopleKey':people,'common':people}];insure_json.uid=maininsureuid;if(!insures[maininsureuid]){insures[maininsureuid]={'insure':insure_json,'inscusts':{}};}else{insures[maininsureuid].insure.clients.push({'peopleKey':people,'common':people});}
insures[maininsureuid].insure.count=insures[maininsureuid].insure.clients.length;$tr.find('input.inscust').filter(':checked').each(function(){var inscust=$(this).val();var data=$(this).data();var inscust_json=data.json;inscust_json.clients=[{'peopleKey':people,'common':people}];if(!insures[maininsureuid]['inscusts'][inscust]){insures[maininsureuid]['inscusts'][inscust]=inscust_json;}else{insures[maininsureuid]['inscusts'][inscust].clients.push({'peopleKey':people,'common':people});}
insures[maininsureuid]['inscusts'][inscust].count=insures[maininsureuid]['inscusts'][inscust].clients.length;});});var params={INSURES:[]};service_counter=-1;$.each(insures,function(key,row){service_counter++;var insure=row.insure;insure.addinfant=0;params.INSURES[service_counter]=insure;$.each(row.inscusts,function(key_inscust,row_inscust){service_counter++;params.INSURES[service_counter]=row_inscust;});});$.post(_ROOT_URL+$.param({CLAIM:claim,samo_action:'CLAIM_INSURANCE_LIST_SAVE'}),params,false);}else{$.modal.close();}});});});$module_container.on('click','span.add_people',function(){let claim=parseInt($(this).parents('table:first').data('claim'));if($('#claim_edit').length){$.notify({text:samo.i18n('ALREADY_CLAIM_EDIT'),type:'error'});}else{$.getScript(samo.ROUTES.claim_edit.url+$.param({CLAIM:claim,claim_edit_action:'add_people'}));}});samo.load_orders=function(CLAIM){$.getScript(getParams('CLAIMORDERS')+'&CLAIM='+CLAIM,function(){samo.short_description();});};samo.loadClaimOrders=function(claimId,callback){$.getScript(getParams('CLAIMORDERS')+'&CLAIM='+claimId,callback);}
$module_container.on('click','.claim_banner',function(e){if(e.target.tagName==='A'){return true;}
if($(this).hasClass('close')){$(this).animate({height:'15px'},function(){$(this).removeClass('close');$(this).children('[data-name="flag"]').removeClass('down').addClass('up');});}else{$(this).animate({height:$(this)[0].scrollHeight},function(){$(this).addClass('close');$(this).children('[data-name="flag"]').removeClass('up').addClass('down');});}});function getClaims(){$module_container.find('.resultset').empty().get(0).scrollIntoView();var page=parseInt(arguments[0],10)||1;$.getScript(getParams('RESULT')+'&CLAIMPAGE='+page,function(){samo.short_description();});}
samo.controls.PARTNER=$module_container.find('.PARTNER');samo.loadBtn.on('click',getClaims);function getParams(action){var useGET=arguments[1]||false;var result={};result.samo_action=action;_controls.each(function(){var name=this.name||$(this).attr('name');var value=$.controlValue(this,useGET);if(name&&value&&value!==0){result[name]=value;}});if(result.CLAIMBEGIN){$('select.CLAIMTYPE',$module_container).val('1');$('select.PAYTYPE',$module_container).val('0');$('select.PARTNERCLAIM',$module_container).val('0');$('select.STATECLAIM',$module_container).val('0');$('select.MANAGERCLAIM',$module_container).val('0');$('select.TOMANAGERCLAIM',$module_container).val('0');}
result.CLAIMTYPE=$('select.CLAIMTYPE',$module_container).val();result.PAYTYPE=$('select.PAYTYPE',$module_container).val();result.PARTNERCLAIM=$('select.PARTNERCLAIM',$module_container).val();result.STATECLAIM=$('select.STATECLAIM',$module_container).val();result.MANAGERCLAIM=$('select.MANAGERCLAIM',$module_container).val();result.TOMANAGERCLAIM=$('select.TOMANAGERCLAIM',$module_container).val();return _ROOT_URL+$.param(result);}
function edit_tourist_link(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim'),CHECKOUT=$obj.data('checkout'),PEOPLE=$(this).parents('tr:first').data('people');$.getScript(samo.ROUTES.edit_tourist.url+$.param({CLAIM:CLAIM,PEOPLE:PEOPLE,CHECKOUT:CHECKOUT}));}
samo.edit_people=function(people){if(samo.ROUTES.edit_tourist){$module_container.find('#people_'+people).find('.edit_tourist .link').triggerHandler('click');}};function visa_status_link(){var $self=$(this),PEOPLE=parseInt($self.parents('tr:first').data('people'),10),OPEOPLE=parseInt($self.data('opeople'),10),CLAIM=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);$.getScript(samo.ROUTES.visa_status.url+$.param({CLAIM:CLAIM,PEOPLE:PEOPLE,OPEOPLE:OPEOPLE}));}
function e_doc_link(){var CLAIM=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);samo.e_doc(CLAIM);}
function edoc_upload_scan_visa(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim');var PEOPLE=$(this).parents('tr:first').data('people');$.getScript(_ROOT_URL+$.param({CLAIM:CLAIM,PEOPLE:PEOPLE,samo_action:'E_DOC_TAB_ADD'}));}
samo.e_doc=function(CLAIM){$.getScript(_ROOT_URL+$.param({CLAIM:CLAIM,samo_action:'E_DOC'}),function(){$module_container.find('.multiCheck').chosen().on('change',function(){});});};samo.claim_modules=function(claim){var $c_container=$module_container;if(typeof claim!='undefined'){$c_container=$('#cl_'+claim);}
$c_container.find('td.cl_alink').each(function(){var $this=$(this);var claim=parseInt($this.parents('.cl_refer_result:first').data('claim'),10);if($('#orders_'+claim+' .toggle_orders').length===0){samo.claim_orders(claim);}
$this.find('.e_doc').on('click',e_doc_link);}).end().find('span.cl_price').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,samo_action:'COST'}),false);}).end().find('button.ClaimConfirmPreOrder').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,fromCanceled:$(this).data('fromCancel'),samo_action:'CLAIM_CONFIRM_PREORDER'}),false);}).end().find('button.ClaimConfirmGetPromo').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,fromCanceled:$(this).data('fromCancel'),samo_action:'CLAIM_CONFIRM_GET_PROMO'}),false);}).end().find('.link.phys_byer').on('click',edit_phys_byer_link).end().find('.link.edit_payer').on('click',edit_payer_link).end().find('.link.pay_variant').on('click',pay_variant_link).end().find('.add_partner_comment').on('click',edit_partner_comment_link);samo.helpalt_field(container,'hover','bottomLeft');};samo.claim_orders=function(claim){var $tbl=$('#cl_'+claim);var cl_status=parseInt($tbl.data('status'),10);var $orders=$('#orders_'+claim);$orders.on('click','.o_pcount',function(){var self=$(this).parent();$orders.find('tr.highlight').removeClass('highlight');self.addClass('highlight');samo.highlight_peoples(claim,self.data('peoples'));}).on('click','.frplacement',init_frplacement);$orders.find('.gds_tickets').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,samo_action:'GDS_TICKETS'}),function(){$('.gds_ticket_close').on('click',function(){$.modal.close();});$('.gds_ticket_agree').on('click',function(){$.getScript(_ROOT_URL+$.param({CLAIM:claim,samo_action:'GDS_TICKETS_ISSUE'}),function(){$('.gds_ticket_close').on('click',function(){$.modal.close();});});});});});if(cl_status!==3&&cl_status!==4&&cl_status!==5){if(samo.ROUTES.edit_tourist){$orders.find('.edit_tourist').on('click',edit_tourist_link);}}
$orders.find('span.visa_status_link').on('click',visa_status_link);$orders.find('span.edoc_upload_scan_visa').on('click',edoc_upload_scan_visa);$orders.find('.add_visa').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);var people=$(this).parents('tr:first').data('people');$.getScript(_ROOT_URL+$.param({CLAIM:claim,PEOPLE:people,samo_action:'CLAIM_VISA_LIST'}),function(){$('.claim_visas_list_save').on('click',function(){var $element=$("#ADDITIONAL_VISAS input[name='CLAIM_PEOPLE_VISA']:checked");if($element.length){var visapr=$element.val();var data=$element.data('json');var params={PARTNER:data.partner,PEOPLE:people,VISAPR:visapr,};$.post(_ROOT_URL+$.param({CLAIM:claim,samo_action:'CLAIM_VISA_LIST_SAVE'}),params,false);}});});});$orders.find('.delete_service, .delete_insure').on('click',function(){var servicePacketName=$(this).parents('.service:first').data('servicepacketname');if(servicePacketName){if(!confirm(samo.i18n('CONFIRM_DELETE_ORDER_SET',{name:servicePacketName}))){return false;}}else{if(!confirm(samo.i18n('CONFIRM_DELETE_ORDER'))){return false;}}
var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);var order=parseInt($(this).parents('.service:first, .insure:first').data('order'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'CLAIM_ORDER_DELETE'}),null);});$orders.find('.freightInfo').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);var order=parseInt($(this).parents('.service:first, .insure:first').data('order'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'SERVICE_FREIGHT_INFO'}),function(){$('#FREIGHTINFO').find('.FREIGHTINFO_DATE').datePicker();$('#FREIGHTINFO').find('.FREIGHTINFO_DATE_BACK').datePicker();$('#FREIGHTINFO').find('.FREIGHTINFO_PORT').chosen();$('#FREIGHTINFO').find('.FREIGHTINFO_TIME').mask('99:99');$('#FREIGHTINFO').find('.FREIGHTINFO_TIME_BACK').mask('99:99');$('#FREIGHTINFO').find('.need_freight_info__save').on('click',function(){const $port=$('#FREIGHTINFO').find('.FREIGHTINFO_PORT'),port=$port.val();if(!port){$port.errorField(samo.i18n('NO_FREIGHTINFO'));return false;}
let $freight=$('#FREIGHTINFO').find('.FREIGHTINFO_FREIGHT'),freight=$freight.val();if(!freight){$freight.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
let $date=$('#FREIGHTINFO').find('.FREIGHTINFO_DATE'),date=$date.val();if(!date){$date.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
let $time=$('#FREIGHTINFO').find('.FREIGHTINFO_TIME'),time=$time.val();if(!time){$time.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
let transferTypeInc=$('.transfer').val();let TRANSFER_TYPE_AHA=$('.TRANSFER_TYPE_AHA').val();let $freightBack=$('.FREIGHTINFO_FREIGHT_BACK'),freightBack=$freightBack.val();if(transferTypeInc==TRANSFER_TYPE_AHA&&!freightBack){$freightBack.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
let $dateBack=$('.FREIGHTINFO_DATE_BACK'),dateBack=$dateBack.val();if(transferTypeInc==TRANSFER_TYPE_AHA&&!dateBack){$dateBack.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
let $timeBack=$('.FREIGHTINFO_TIME_BACK'),timeBack=$timeBack.val();if(transferTypeInc==TRANSFER_TYPE_AHA&&!timeBack){$timeBack.errorField(samo.i18n('NO_FREIGHTINFO'));is_ok=false;return false;}
if(timeBack||time){if(transferTypeInc==TRANSFER_TYPE_AHA&&samo.validationTime(timeBack)){$timeBack.errorField(samo.i18n('TIME_ERROR'));is_ok=false;return false;}else if(samo.validationTime(time)){$time.errorField(samo.i18n('TIME_ERROR'));is_ok=false;return false;}}
var params={};params.CLAIM=parseInt($('#FREIGHTINFO').data('claim'),10);params.ORDER=parseInt($('#FREIGHTINFO').data('order'),10);params.freightinfo_port=port;const $option=$port.find('option:selected');params.freightinfo_terminal=$option.data('terminal');params.freightinfo_freight=freight;params.freightinfo_freight_back=freightBack;params.freightinfo_date=date;params.freightinfo_date_back=dateBack;params.freightinfo_time=time;params.freightinfo_time_back=timeBack;params.transferTypeInc=transferTypeInc;$.post(_ROOT_URL+$.param({CLAIM:claim,samo_action:'SERVICE_FREIGHT_INFO_SAVE'}),params,false);});});});$orders.find('.change_freight').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);var order=parseInt($(this).parents('.freight:first').data('order'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'CLAIM_FREIGHT_LIST'}),function(){var $container=$('.FREIGHTSINFO');if($container.length){$container.on('click','.freightsFilter .hideLink a',function(){$($(this).parent().attr('data-hide-target')).toggle();return false;}).on('change','.freightsFilter select',function(){var selectName=$(this).attr('name');if(selectName=='flight_types'||selectName=='full_airline'){samo.refreshFreightTable();}});}
var filterByFlyDuration=$container.find('#flyDurationSlider');if(filterByFlyDuration.length){samo.filterSliders(filterByFlyDuration);}
$('._frmSendFreight').prop('disabled',false);$('._frmTownsFreight').prop('disabled',false);$('.claim_freights_list_save').on('click',function(){var freightSelect=$container.find('.freightTable input[data-checked=checked]');if(freightSelect.length){var $tr=$(freightSelect).parents('tr:first');if($tr.hasClass('superfreight')){$.notify(samo.i18n('SUPERFREIGHT_SELECTED'));return false;}else{var params={};var claim=parseInt($container.data('claim'),10);var order=parseInt($container.data('order'),10);var freights=[];var offerHash=$($tr).data('offerHash');$container.find('tr[class*=-'+offerHash+']').each(function(){freights.push({'order_inc':$(this).data('order_inc'),'freight':$(this).data('freight')});});params.FREIGHTS=freights;$.post(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'CLAIM_FREIGHTS_SAVE'}),params,false);}}});$('.claim_freights_list_close').on('click',function(){$('.trFreights').removeClass('trFreights_show');});});});$orders.find('.delete_visa').on('click',function(){var claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);var $tr_visa=$(this).parents('.visa:first');var order=parseInt($tr_visa.data('order'),10);$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'CLAIM_VISA_FOR_DELETE'}),function(){var $container=$('#basicModalContent').find('#OPEOPLE_LIST');var $save=$container.find('.save');$container.find('.order_info').html($tr_visa.find('td:first').html());$container.on('click','input:checkbox',function(){$save.prop('disabled',$container.find('input:checked').length==0);});$save.prop('disabled',$container.find('input:checked').length==0);$save.on('click',function(){var opeoples=[];$container.find('input:checked').each(function(){opeoples.push($(this).val());});if(opeoples){var params={OPEOPLES:opeoples.join(',')};var claim=parseInt($container.data('claim'),10);var order=parseInt($container.data('order'),10);$.post(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'CLAIM_VISA_DELETE'}),params,false);}});});});$orders.find('.change_hotel').on('click',function(){if($('#claim_edit').length){$.notify({text:samo.i18n('ALREADY_CLAIM_EDIT'),type:'error'});}else{const claim=parseInt($(this).parents('.cl_refer_result:first').data('claim'),10);const order=parseInt($(this).parents('.hotel:first').data('order'),10);$.getScript(samo.ROUTES.claim_edit.url+$.param({CLAIM:claim,ORDER:order,claim_edit_action:'change_hotel'}));}});};$(document).on('click','tr[class*=_freightOffer-]',function(event){var offerHash=$(this).data('offerHash');var $container=$('.FREIGHTSINFO');$container.find('input[class*=_dataCheckedFR]').removeAttr('data-checked');$container.find('input._dataCheckedFR'+offerHash).attr('data-checked','checked');$container.find('input._dataCheckedFR'+offerHash+'[type=hidden]').attr('data-checked','checked');$container.find('input._dataCheckedFR'+offerHash+'[type=radio]').prop('checked',true);unHightlight($(this),'checked');});$(document).on('click','._freightPlanReplace',function(event){$(this).parent().click();var $container=$('.FREIGHTSINFO');var freightSelect=$container.find('.freightTable input[data-checked=checked]');if(freightSelect.length){var $tr=$(freightSelect).parents('tr:first');var params={};var claim=parseInt($container.data('claim'),10);var order=parseInt($container.data('order'),10);var freights=[];var offerHash=$($tr).data('offerHash');$container.find('tr[class*=-'+offerHash+']').each(function(){freights.push({'order_inc':$(this).data('order_inc'),'freight':$(this).data('freight'),'external':$(this).data('external')});});params.FREIGHTS=freights;var offerid=$($tr).data('offerid');$.post(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,offerid:offerid,samo_action:'EXTERNAL_CLAIM_FREIGHTS_PLANS'}),params,false,'script');}});$(document).on('click','._freightPlanTabPanel',function(){var tabid=$(this).data('tabid');$('._freightPlanTab').addClass('hidden');$('#freightPlanTab'+tabid).removeClass('hidden');$('._freightPlanTabPanel').each(function(index,el){$(el).removeClass('searchmode_selected');$(el).addClass('searchmode_not_selected');$('#freightPlanTabLabel'+$(el).data('tabid')).addClass('searchmode_button');});$('#freightPlanTabLabel'+tabid).removeClass('searchmode_button');$('#freightPlanTabPanel'+tabid).removeClass('searchmode_not_selected');$('#freightPlanTabPanel'+tabid).addClass('searchmode_selected');});$(document).on('click','.freightPlanReplaceButton',function(){var params=$(this).data();params.ORDER=$(this).data('order');$.post(getParams('SET_FREIGHTS_PLAN'),params,null,'script');});samo.delete_order=function(claim,order){$('#orders_'+claim+' #order_'+order+' button.delete').triggerHandler('click');};samo.cancel_claim=function(claim){$('#CANCEL_CLAIM_REASON_SELECT').on('change',function(){$('#CANCEL_CLAIM_REASON_ATTACHMENT').toggle(!!$(this).find('option:selected').data('need-attachment'));$('#CANCEL_CLAIM_REASON_ATTACHMENT').val('');let need_note=$(this).find('option:selected').data('need-note');$('.CANCEL_CLAIM_REASON_NOTE').toggle(!!need_note);if(need_note){let keytype=$(this).find('option:selected').data('keytype');let additional_note=$(this).find('option:selected').data('additional_note');$('.CANCEL_CLAIM_REASON_NOTE').html('<br>'+'');if(additional_note.length){$('.CANCEL_CLAIM_REASON_NOTE').append('<span>'+additional_note+'</span><br><br>');}
if(keytype=='int'){$('.CANCEL_CLAIM_REASON_NOTE').append('<input type="text" name="cancel_claim_reason_note" id="CANCEL_CLAIM_REASON_NOTE" class="addit '+keytype+'">');$('#basicModalContent').find('input[type=text].addit.int').on('keypress',samo.key_press_filter);}else{$('.CANCEL_CLAIM_REASON_NOTE').append('<textarea name="cancel_claim_reason_note" id="CANCEL_CLAIM_REASON_NOTE"></textarea>');}}})
$('#agreement').on('click',function(){var result=new FormData();result.append('CLAIM',claim);result.append('CANCEL_CLAIM_PENALTY',$(this).val());if($('#CANCEL_CLAIM_REASON_SELECT')){var reason_value=parseInt($('#CANCEL_CLAIM_REASON_SELECT').val());if(reason_value===0){$.notify({text:samo.i18n('NO_CHOOSE_CANCEL_REASON'),type:'error'});return false;}
result.append('CANCEL_CLAIM_REASON_SELECT',reason_value);}
if($('#CANCEL_CLAIM_REASON_ATTACHMENT')&&$('#CANCEL_CLAIM_REASON_SELECT').find('option:selected').data('need-attachment')){var reason_attachment=$('#CANCEL_CLAIM_REASON_ATTACHMENT').val();if(reason_attachment===''){$.notify({text:samo.i18n('NO_CHOOSE_CANCEL_ATTACHMENT'),type:'error'});return false;}
var $elements=$('#CANCEL_CLAIM_REASON_ATTACHMENT');var upload_format=$('#CANCEL_CLAIM_REASON_SELECT option:selected').data('upload_format');var upload_max_size=$('#CANCEL_CLAIM_REASON_SELECT option:selected').data('upload_size');if(samo.check_file_extension($elements,upload_format,upload_max_size)){result.append('CANCEL_CLAIM_REASON_ATTACHMENT',document.getElementById('CANCEL_CLAIM_REASON_ATTACHMENT').files[0]);}else{return false;}}
if($('#CANCEL_CLAIM_REASON_NOTE')&&$('#CANCEL_CLAIM_REASON_SELECT').find('option:selected').data('need-note')){let reason_note=$('#CANCEL_CLAIM_REASON_NOTE').val().trim();if(!reason_note.length){$('#CANCEL_CLAIM_REASON_NOTE').errorField(samo.i18n('REQUIRED_FIELD_EMPTY'));return false;}
result.append('CANCEL_CLAIM_REASON_NOTE',reason_note);result.append('CANCEL_CLAIM_REASON_NOTE_KEYTYPE',$('#CANCEL_CLAIM_REASON_SELECT').find('option:selected').data('keytype'));}
this.disabled=true;$.ajaxSetup({processData:false,contentType:false});$.post(samo.ROUTES.cancel_claim.url+'samo_action=request',result,null,'script');});};samo.claim_cost=function(){$('.pay_claim').on('click',function(){$.modal.close();var params={CLAIM:$(this).data('claim')};var pay_variant_url=samo.ROUTES.pay_variant.url+$.param(params);window.open(pay_variant_url,'pay_variant_'+params.CLAIM);});};samo.claim_confirm_preorder=function(){$('.close').on('click',function(){$.modal.close();});$('.load').on('click',function(){$.modal.close();$.getScript(_ROOT_URL+$.param({CLAIM:$(this).data('claim'),CLAIM_CONFIRM_PREORDER_PRICE:$(this).data('preorder_price'),CLAIM_CONFIRM_PREORDER_BRON:1,samo_action:'CLAIM_CONFIRM_PREORDER'}),null);});};samo.claim_confirm_get_promo=function(){$('#basicModalContent .promo-btn').on('click',function(){var $promocode=$("#promo_codetext"),promocode=$promocode.val().trim();if(!promocode.length){$promocode.errorField(samo.i18n('REQUIRED_FIELD_EMPTY'));}else{$.getScript(_ROOT_URL+
$.param({CLAIM:$(this).data('claim'),CLAIM_CONFIRM_PROMO_CODETEXT:promocode,samo_action:'CLAIM_CONFIRM_PROMO_SAVE'}));}});};samo.highlight_peoples=function(claim,peoples){$(String(peoples).split(',')).each(function(){$('#people_'+this).addClass('highlight');});};(function(){var claim=$module_container.find('.cl_refer_result');if(claim){samo.claim_modules();}})();samo.initHotelPopup($module_container);samo.short_description();var unHightlight=function(obj,cssClass){if(typeof cssClass=='undefined'){cssClass='yellow';}
var offerHash=obj.data('offerHash');$('tr[class*=_freightOffer]').removeClass(cssClass);$('tr[class*=-'+offerHash+']').addClass(cssClass);};$(document).on('mouseenter','tr[class*=_freightOffer-]',function(){unHightlight($(this));});$(document).on('mouseup','input[class*=_dataCheckedFR]',function(){$(this).parent().parent().trigger('click');event.preventDefault();});function edit_payer_link(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim');$.getScript(_ROOT_URL+$.param({samo_action:'choose_payer',CLAIM:CLAIM}));}
function pay_variant_link(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim');$.getScript(_ROOT_URL+$.param({samo_action:'pay_variant_check_owner',CLAIM:CLAIM}));}
samo.edit_payer=function(){$('#basicModalContent').find('.save').on('click',function(){var params={};params.enablepay_bytourist=$.radioValue('payer');var CLAIM=$('#basicModalContent').find('input[name="CLAIM"]').val();$.post(_ROOT_URL+$.param({samo_action:'edit_payer',CLAIM:CLAIM}),params,null,'script');});};function edit_partner_comment_link(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim');$.getScript(_ROOT_URL+$.param({samo_action:'partner_comment',CLAIM:CLAIM}),function(){var maxWidth=0;$('.partnercomment').find('input').on('click',function(){$('.partnercomment').find('input[name=addit_'+this.value+']').prop('disabled',!this.checked);}).end().find('label.has_input').each(function(){maxWidth=Math.max($(this).width(),maxWidth);}).each(function(){$(this).width(maxWidth+3);});});}
samo.edit_partner_comment=function(){$('#basicModalContent').find('.save').on('click',function(){var params={};var partner_comment='';$('#basicModalContent').find(':checked').each(function(){var val_addit=$('#basicModalContent').find('input[name=addit_'+this.value+']').val()||'';if(val_addit){val_addit='{'+val_addit.replace(/[{|}|\|]/g,' ')+'}';}
partner_comment=partner_comment+this.value+val_addit+'|';});params.partner_comment=partner_comment;var CLAIM=$('#basicModalContent').find('input[name="CLAIM"]').val();$.post(_ROOT_URL+$.param({samo_action:'edit_partner_comment',CLAIM:CLAIM}),params);});$('#basicModalContent').find('input[type=text].addit.int').on('keypress',samo.key_press_filter);};function edit_phys_byer_link(){var $obj=$(this).parents('.cl_refer_result:first'),CLAIM=$obj.data('claim');$.getScript(_ROOT_URL+$.param({samo_action:'phys_byer',CLAIM:CLAIM}));}
samo.phys_byer=function(){samo.buyer_fields_events();};samo.buyer_fields_events=function(){let $phys_byer=$('#phys_byer');$phys_byer.find('[name*="[BUYER_TYPE]"]').off('change').on('change',function(){samo.buyer_fields();});$phys_byer.find('[name*="[NATIONALITY]"]').off('change').on('change',function(){ReloadBuyerDetail();});ReloadBuyerDetail=function(){var params={};params.NATIONALITY=$('#phys_byer').find('[name*="[NATIONALITY]"]').val();$.post(_ROOT_URL+$.param({samo_action:'RELOADBUYERDETAIL',CLAIM:$('#phys_byer').data('claim')}),params,function(){$('#phys_byer').find('[name*="[IDENTITY_DOCUMENT]"]').triggerHandler('change');});};$phys_byer.find('.date').datePicker();$phys_byer.find('select').chosen();$phys_byer.find('[name*="[IDENTITY_DOCUMENT]"]').triggerHandler('change');$phys_byer.find('.load').on('click',function(){var params={};if(check_fields()){$phys_byer.find('input').each(function(){params[this.name]=$.controlValue(this);});$phys_byer.find('select[name*="[phys_byer]"]').each(function(){params[this.name]=$.controlValue(this);});$.post(_ROOT_URL+$.param({samo_action:'phys_byer_edit',CLAIM:$phys_byer.data('claim')}),params,null,'script');}}).end().find('.date').datePicker();function check_fields(){var is_ok=true;samo.field.clear_errors($phys_byer);$phys_byer.find('.required').not('label').each(function(){if(!$(this).val().length){is_ok=samo.field.error(samo.i18n('REQUIRED_FIELD_EMPTY'),this);return false;}});if(is_ok){$phys_byer.find('.date').each(function(){if(this.value.length&&!valid_date($.controlValue(this))){is_ok=samo.field.error(samo.i18n('DATE_FORMAT_TITLE'),this);return false;}});}
return is_ok;}
function valid_date(value){value=parseInt(value);if(value>20600000||value<19010000){return false;}
return value;}}
samo.buyer_fields=function(){let $phys_byer=$('#phys_byer');let params={};params.BUYER_TYPE=$phys_byer.find('[name*="[BUYER_TYPE]"]').val();$.post(_ROOT_URL+$.param({samo_action:'RELOAD_BUYER_FIELDS',CLAIM:$phys_byer.data('claim')}),params,function(){samo.buyer_fields_events();},'script');}
$module_container.on('click','span.add_railway_tickets',function(){let claim=parseInt($(this).parents('table:first').data('claim'));if($('#claim_edit').length){$.notify({text:samo.i18n('ALREADY_CLAIM_EDIT'),type:'error'});}else{$.getScript(samo.ROUTES.add_railway_tickets.url+$.param({CLAIM:claim}));}});};samo.e_doc_post=function(){var _ROOT_URL=samo.ROUTES.cl_refer.url;var $edoc=$('#e_doc');var mes=$edoc.data('confirm-note');$edoc.find('a.confirm_required').on('click',function(){if(!confirm(mes)){return false;}}).end().find('a.external').on('click',samo.delayed_download);$('tr.flash').addClass('blink-once');setTimeout(function(){$('tr.flash').removeClass('blink-once');},3000);$('#e_doc_tabs .e_doc_tab_selected').prop('disabled',true);$('#E_DOC_BTN_PRINT').on('click',function(){this.disabled=true;var CLAIM=$('#e_doc').data('claim');$.getScript(_ROOT_URL+$.param({CLAIM:CLAIM,samo_action:'E_DOC'}));});$('#E_DOC_BTN_ADD').on('click',function(){this.disabled=true;var CLAIM=$('#e_doc').data('claim');$.getScript(_ROOT_URL+$.param({CLAIM:CLAIM,samo_action:'E_DOC_TAB_ADD'}));});$('#E_DOC_TYPE').on('change',function(){var doctype=$(this).val(),$container=$('#UPLOAD_DIV');var upload_file_format=$(this).find('option:selected').data('upload_format');var upload_req_people=$(this).find('option:selected').data('upload_req_people');$('.type_note_x').addClass('hidden');$('#upload_file_format').html(upload_file_format);if(doctype>0){$('#type_note_'+doctype).removeClass('hidden');if(upload_req_people==1){$('#E_DOC_PEOPLE_DIV').removeClass('hidden');}else{$('#E_DOC_PEOPLE_DIV').addClass('hidden');}
$container.removeClass('hidden');}else{$container.addClass('hidden');}}).triggerHandler('change');$('#E_DOC_BTN_UPLOAD').on('click',function(){var CLAIM=$('#e_doc').data('claim');var $elements=$('#edoc_file');var doctype=$('#E_DOC_TYPE').val();var upload_format=$('#E_DOC_TYPE option:selected').data('upload_format');var upload_max_size=$('#E_DOC_TYPE option:selected').data('upload_size');var upload_req_people=$('#E_DOC_TYPE option:selected').data('upload_req_people');var people=$('#E_DOC_PEOPLE').val();var is_ok=(upload_req_people==0)||(upload_req_people==1&&people>0);if(is_ok){if(samo.check_file_extension($elements,upload_format,upload_max_size)){var load_btn=samo.loadBtn;samo.loadBtn=$(this);$.ajax({async:true,dataType:'iframe script',type:'POST',url:_ROOT_URL+$.param({CLAIM:CLAIM,PEOPLEINC:people,EDOC_UPLOAD_DOCTYPE:doctype,samo_action:'UPLOAD_EDOC',is_js:1}),fileInput:$elements});samo.loadBtn=load_btn;}}else{$.notify({text:samo.i18n('UPLOAD_REQ_PEOPLE'),type:'error'});}});var $disableDownload=function(){var $checked=$('#e_doc td.ids input:checked').length;$('#multiDownload').prop('disabled',$checked==0);};$('#e_doc th.ids .multiCheck').on('change',function(){var _filter=$(this).val();if(_filter){$('#e_doc td.ids input.'+_filter).prop('checked',true);}else{$('#e_doc td.ids input.any').prop('checked',false);}
$disableDownload();});$('#e_doc td.ids input').on('click',function(){$('#e_doc th.ids select').val('');$disableDownload();});$('#multiDownload').on('click',function(){this.disabled=true;$(this).addClass('loading');var ids=[];$('#e_doc td.ids input:checked').each(function(){ids.push(this.value);});var CLAIM=$('#e_doc').data('claim');var url=samo.ROUTES.cl_refer.url+$.param({CLAIM:CLAIM,samo_action:'MULTIDOWNLOAD',ids:ids.join(",")});$.getScript(url,null,false,false,function(){$('#multiDownload').prop('disabled',false);});});};samo.e_doc_multi=function(params){if(typeof params.retry!='undefined'){setTimeout(function(){var CLAIM=$('#e_doc').data('claim');var url=samo.ROUTES.cl_refer.url+$.param({CLAIM:CLAIM,samo_action:'MULTIRESULT',guid:params.guid});$.getScript(url,null,false,false,function(){$('#multiDownload').prop('disabled',true);});},parseInt(params.retry)*1000);}
if(typeof params.result!='undefined'){$.each(params.result,function(){var doc=this;var $tr=$('#e_doc table.res tbody tr').filter(function(){return $(this).find('input[value="'+doc.id+'"]').length==1;});if($tr.length){if(doc.error&&!doc.url){$tr.addClass('pack-failed').find('td:last').find('a').replaceWith('<span class="red">'+doc.error+'</span>').end().end().find('input').remove();}
if(doc.url){if(doc.error){$tr.addClass('pack-failed').find('td:last').find('a').addClass('error').attr('data-title',doc.error);}else{var name=doc.url;var name_parts=doc.url.split('/').pop().split('_'),ext=doc.url.split('.').pop();if(name_parts.length<=3){name=name_parts[1]+'_'+name_parts[0]+'.'+ext;}else if(name_parts.length==4){name=name_parts[1]+'_'+name_parts[0]+'_'+name_parts[2]+'.'+ext;}else{name=name_parts.join('_');}
$tr.addClass('pack-success').find('td:last').find('a').attr('href',doc.url).addClass('printed').removeClass('external').attr('download',name).attr('title',samo.dateAsString(new Date(),samo.dateFormat+' HH:MM')).off('click');}}}});setTimeout(function(){$('#e_doc').find('tr.pack-failed,tr.pack-success').removeClass('pack-failed').removeClass('pack-success');},10000);$('#e_doc').find('input:checked').prop('checked',false);$('#multiDownload').prop('disabled',true);}
if(typeof params.url!='undefined'){samo.download_file(params.url);$('#multiDownload').prop('disabled',true).removeClass('loading');}
if(typeof params.error!='undefined'){if(typeof params.fatal!='undefined'&&params.fatal==true){$('#multiDownload').remove();$('#e_doc .ids').hide();$.notify({text:params.error,type:'error'});}else{$('#multiDownload').prop('disabled',false).errorField(params.error).removeClass('loading');}}};samo.frplacement_save=function(button,$pTable){button.disabled=true;var data=null,_data=null,$peoples=$pTable.find('tbody tr');var seats={},seats_count=0,changes=0;data=$pTable.data();$peoples.each(function(){_data=$(this).data();if(_data.inc){seats[_data.opeople]={'inc':_data.inc,'name':_data.name};seats_count++;}else{seats[_data.opeople]={'inc':0,'name':''};}
if(!data.seats||!data.seats[_data.people]||data.seats[_data.people]['inc']!=seats[_data.opeople]['inc']){changes++;}});var url=samo.ROUTES.cl_refer.url+$.param({CLAIM:data.claim,ORDER:data.order,samo_action:'SAVE_FRPLACEMENT'});if(changes>0){var params={seats:seats};$.post(url,params,function(){button.disabled=frplacement_disabled=false;if(typeof samo.seats!=='undefined'&&Object.keys(samo.seats).length==$peoples.length){$('#order_'+data.order).find('.frplacement.red').removeClass('warning_info');}else{$('#order_'+data.order).find('.frplacement').addClass('warning_info');}
samo.seats={};},'script');}else{$.modal.close();}};var frplacement_disabled=false;var init_frplacement=function(event){event.stopImmediatePropagation();var $span=$(event.target),$tr=$span.parents('tr:first'),data=$tr.data();if(!frplacement_disabled){var params={freight:data.freight};frplacement_disabled=true;params.maxWidth=container.width();params.maxHeight=$(window).height();var CLAIM=$tr.parents('.cl_refer_result').data('claim');var url=samo.ROUTES.cl_refer.url+$.param({CLAIM:CLAIM,ORDER:data.order,samo_action:'CHOOSE_FRPLACEMENT'});$.post(url,params,function(){frplacement_disabled=false;},'script');}};samo.tr_lights=function(){var hashLi='',hashOld='old',lightLi='';var $table=$('#gdsGrid');if($table.find('tbody tr').length){$table.show();$table.find('tbody tr:not(.note):visible').each(function(){var trLi=$(this);hashLi=trLi.attr('data-offer-hash');trLi.removeClass('even').removeClass('odd');if(hashOld!==hashLi){lightLi=(lightLi==='odd')?'even':'odd';trLi.addClass(lightLi);hashOld=hashLi;}else{trLi.addClass(lightLi);}});}else{$table.hide();}};samo.filterSliders=function(){var sliders=['flyDurationSlider','departTimeOnSlider','departTimeOffSlider'];var sections=['fly_duration','depart_time_on','depart_time_off'];for(var i=0;i<sliders.length;i++){var slider=document.getElementById(sliders[i]);if(slider){var min=isNaN(parseInt(samo.getValuesBySlideRange('min',sections[i])))?false:parseInt(samo.getValuesBySlideRange('min',sections[i]));var max=isNaN(parseInt(samo.getValuesBySlideRange('max',sections[i])))?false:parseInt(samo.getValuesBySlideRange('max',sections[i]));if(min&&max&&(min!=max)){noUiSlider.create(slider,{start:[min,max],behaviour:'drag-tap',connect:true,step:30,range:{'min':min,'max':max}});}}}
var flyDurationVals=[document.getElementById('fly-duration-value-lower'),document.getElementById('fly-duration-value-upper')];var departTimeOnVals=[document.getElementById('depart-time-on-value-lower'),document.getElementById('depart-time-on-value-upper')];var departTimeOffVals=[document.getElementById('depart-time-off-value-lower'),document.getElementById('depart-time-off-value-upper')];var flyDuration=document.getElementById('flyDurationSlider');var departTimeOn=document.getElementById('departTimeOnSlider');var departTimeOff=document.getElementById('departTimeOffSlider');if(typeof flyDuration.noUiSlider!=='undefined'){flyDuration.noUiSlider.on('update',function(values,handle){flyDurationVals[handle].innerHTML=((parseInt(values[handle]/ 60)<10)?'0':'')+parseInt(values[handle]/ 60)+':'+
((parseFloat(values[handle]%60)>0)?((parseFloat(values[handle]%60)<10)?'0':'')+parseFloat(values[handle]%60):'00');});flyDuration.noUiSlider.on('end',function(){samo.refreshFreightTable();});}else{$(flyDuration).parent().parent().hide();}
if(typeof departTimeOn.noUiSlider!=='undefined'){departTimeOn.noUiSlider.on('update',function(values,handle){departTimeOnVals[handle].innerHTML=((parseInt(values[handle]/ 60)<10)?'0':'')+parseInt(values[handle]/ 60)+':'+
((parseFloat(values[handle]%60)>0)?((parseFloat(values[handle]%60)<10)?'0':'')+parseFloat(values[handle]%60):'00');});departTimeOn.noUiSlider.on('end',function(){samo.refreshFreightTable();});}else{$(departTimeOn).parent().parent().hide();}
if(typeof departTimeOff.noUiSlider!=='undefined'){departTimeOff.noUiSlider.on('update',function(values,handle){departTimeOffVals[handle].innerHTML=((parseInt(values[handle]/ 60)<10)?'0':'')+parseInt(values[handle]/ 60)+':'+
((parseFloat(values[handle]%60)>0)?((parseFloat(values[handle]%60)<10)?'0':'')+parseFloat(values[handle]%60):'00');});departTimeOff.noUiSlider.on('end',function(){samo.refreshFreightTable();});}else{$(departTimeOff).parent().parent().hide();}
$('.sortbyduration').off('click').on('click',function(){if($(this).hasClass('asc')){$(this).removeClass('asc');$(this).addClass('desc');_gdsSort('fly_duration','desc');}else if($(this).hasClass('desc')){$(this).removeClass('desc');$(this).addClass('asc');_gdsSort('fly_duration','asc');}else{$(this).addClass('asc');_gdsSort('fly_duration','asc');}
return false;});$('.sortbysurcharge').off('click').on('click',function(){if($(this).hasClass('asc')){$(this).removeClass('asc');$(this).addClass('desc');_gdsSort('surcharge','desc');}else if($(this).hasClass('desc')){$(this).removeClass('desc');$(this).addClass('asc');_gdsSort('surcharge','asc');}else{$(this).addClass('asc');_gdsSort('surcharge','asc');}
return false;});function _gdsSort(field,type){type=type||'asc';var grid=document.getElementById('gdsGrid');var tbody=grid.getElementsByTagName('tbody')[0];var rowsArray=[].slice.call(tbody.rows);var tmpTable=[];var rowSpans=0;var rows=0;var p,i;for(i=0;i<rowsArray.length;i++){rowSpans=rowsArray[i].cells[0].rowSpan;if(i==rows){var toPush=[];for(p=0;p<rowSpans;p++){toPush[p]=rowsArray[i+p];}
var params=JSON.parse(rowsArray[i].dataset.bindFilter);toPush[p]=params[field];tmpTable.push(toPush);rows=i+rowSpans;}}
var compare=function(rowA,rowB){return rowA[rowA.length-1]-rowB[rowB.length-1];};tmpTable.sort(compare);if(type=='desc'){tmpTable.reverse();}
grid.removeChild(tbody);for(i=0;i<tmpTable.length;i++){for(p=0;p<(tmpTable[i].length-1);p++){tbody.appendChild(tmpTable[i][p]);}}
grid.appendChild(tbody);samo.tr_lights();}};samo.refreshFreightTable=function(){var flyDurationEl=document.getElementById('flyDurationSlider');var departTimeOnEl=document.getElementById('departTimeOnSlider');var departTimeOffEl=document.getElementById('departTimeOffSlider');var flyDuration=typeof flyDurationEl.noUiSlider!='undefined'?flyDurationEl.noUiSlider.get():[0,999999999];var departTimeOn=typeof departTimeOnEl.noUiSlider!='undefined'?departTimeOnEl.noUiSlider.get():[0,999999999];var departTimeOff=typeof departTimeOffEl.noUiSlider!='undefined'?departTimeOffEl.noUiSlider.get():[0,999999999];var airlineF=$(".freightsFilter select[name='full_airline'] option:selected");var flightTypesF=$(".freightsFilter select[name='flight_types'] option:selected");$('.freightTable tr').each(function(){$(this).show();var trFilter=JSON.parse($(this).attr('data-bind-filter'));if(airlineF.length&&airlineF.val()!=0){if(trFilter['full_airline']!=airlineF.val()){$(this).hide();}}
if(flightTypesF.length&&flightTypesF.val()!=0){if(trFilter['flight_types']!=flightTypesF.val()){$(this).hide();}}
if(trFilter['fly_duration_on']<parseInt(flyDuration[0])||trFilter['fly_duration_off']<parseInt(flyDuration[0])){$(this).hide();}
if(trFilter['fly_duration_on']>parseInt(flyDuration[1])||trFilter['fly_duration_off']>parseInt(flyDuration[1])){$(this).hide();}
if(trFilter['depart_time_on']<parseInt(departTimeOn[0])){$(this).hide();}
if(trFilter['depart_time_on']>parseInt(departTimeOn[1])){$(this).hide();}
if(trFilter['depart_time_off']<parseInt(departTimeOff[0])){$(this).hide();}
if(trFilter['depart_time_off']>parseInt(departTimeOff[1])){$(this).hide();}});var messagesBlock=$('.freightsRes .messages');if($('.freightTable tr:visible').length==0){messagesBlock.html(samo.i18n('NO_FREIGHTS'));}else{messagesBlock.html('');}
samo.tr_lights();};samo.getValuesBySlideRange=function(type,section){var min=999999999;var max=0;$(".freightTable tr:visible").each(function(){var data=JSON.parse($(this).attr('data-bind-filter'));if(section!='fly_duration'){if(data[section]<min){min=data[section];}
if(data[section]>max){max=data[section];}}else{if(data.fly_duration_on<min){min=data.fly_duration_on;}
if(data.fly_duration_off<min){min=data.fly_duration_off;}
if(data.fly_duration_on>max){max=data.fly_duration_on;}
if(data.fly_duration_off>max){max=data.fly_duration_off;}}});if(type=='min'){return min;}
if(type=='max'){return max+1;}
return false;};samo.toggleClaimOrders=function(claimId,element,elementSelector,textOne,textTwo){let button=$(element);if($(elementSelector).css('display')==='none'){button.text(samo.i18n('LOADING'));samo.loadClaimOrders(claimId,function(){button.text(textTwo);$(elementSelector).show('slow');});}else{$(elementSelector).hide('slow');$(elementSelector).empty();button.text(textOne);}}
samo.toggleShowHideData=function(element,elementSelector){$(element).children().each(function(){$(this).toggleClass('show');$(this).toggleClass('hide');});$(elementSelector).toggleClass('blur');}
function msg(message){$.notify({text:message,type:'error'});}
samo.showFormTicketRefund=function(element){let claim=$(element).closest('table.cl_refer_result').data('claim');let order=$(element).closest('tr').data('order');$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,samo_action:'showFormTicketRefund'}));}
samo.actionTicketRefund=function(element,request,claim,order){let condition=$('input[name = condition]').is(':checked')
if(condition){$.getScript(_ROOT_URL+$.param({CLAIM:claim,ORDER:order,request:request,condition:+condition,samo_action:'actionTicketRefund'}));$.modal.close();samo.load_orders(claim);}else{return false;}}
samo.refundAvailableCondition=function(element){if($(element).is(':checked')){$("button[name='actionTicketRefund']").removeAttr('disabled');}else{$("button[name='actionTicketRefund']").attr('disabled','disabled');}}
samo.disableForm=function(documentGuid){$('#claim_edit').find('.overlay').removeClass('hidden');}
samo.enableForm=function(documentGuid){$('#claim_edit').find('.overlay').addClass('hidden');}
samo.updateClaim=function(documentGuid){var claim=parseInt($('#claim_edit').data('claim'),10);samo.disableForm();$.post(samo.ROUTES.cl_refer.url+$.param({CLAIM:claim,samo_action:'UPDATE_CLAIMINFO'}),{documentGuid:documentGuid},null,'script');};$(samo.cl_refer);})(samo.jQuery);